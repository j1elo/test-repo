# Workflow syntax for GitHub Actions:
# https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions

# Run some verification and organizative work on each newly opened issue.
name: New Issue

# Run only when a new issue is opened.
# (roots/issue-closer action doesn't support other event types)
on:
  issues:
    types: [opened]

jobs:
  # Close the issue if its body doesn't match a regular expression.
  check-template:
    name: Check Template
    runs-on: ubuntu-latest

    steps:
      - name: Issue auto-closer
        uses: roots/issue-closer-action@v1.1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          issue-pattern: '\[[xX]\] I agree to fill this issue template'
          issue-close-message: >
            Hello @${issue.user.login} :wave:! Thanks a lot for reporting an
            issue after finding a bug.


            However, **your report doesn't follow the [issue template](https://github.com/j1elo/test-repo/blob/master/.github/ISSUE_TEMPLATE/bug_report.md)**,
            so it is being automatically closed. We are really sorry for that,
            but we need all reports to follow the template, or else it won't be
            possible to understand and help with all issues.


            Please, create a new issue following the template, or reopen this
            same issue to edit and provide all required information.

  # Add the issue to the "Triage" Project Baord.
  # Runs only if "check-template" succeeded.
  add-to-triage:
    name: Add to Triage
    runs-on: ubuntu-latest
    needs: check-template

    steps:
      - name: GitHub Project Automation+
        uses: alex-page/github-project-automation-plus@v0.3.0
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          project: Triage
